# 版本记录 (VERSIONS)

## v2.0.0 - 2025-10-08

### 重大更新：数据结构适配

**变更概述：**
- 适配新的Training_data数据结构和位置
- 修正数据加载逻辑以处理静态棋盘位置而非走棋序列
- 更新配置文件自动检测数据文件
- 更新文档和使用说明

### 具体变更：

#### 1. 数据路径配置 (config.py)
- **之前**: 默认路径为 `~/data/go_AI_data/pure_data/19x19.data`
- **现在**: 自动检测 `../Training_data/` 目录下的所有 `.data` 文件
- **影响**: 系统现在可以自动使用项目中的130,156个数据文件

#### 2. 数据格式处理 (datasets.py)
- **之前**: 处理走棋序列格式 `[color, x, y]`
- **现在**: 处理静态棋盘位置格式 `[{"B":[x,y]}, {"W":[x,y]}, ...]`
- **训练策略变更**:
  - 从序列学习改为位置学习
  - 为每个棋盘位置生成所有合法下一步的训练样本
  - 保持了原有的训练逻辑和神经网络架构

#### 3. 文档更新 (README.md)
- 更新数据格式说明
- 修正示例命令和路径
- 添加数据结构变更的重要说明
- 更新训练命令以适配新环境

#### 4. 数据分析结果
- **数据文件数量**: 130,156个 `.data` 文件
- **数据格式**: JSON数组包含棋盘位置信息
- **坐标系统**: 1-indexed坐标（标准围棋记谱法）

### 兼容性说明：
- 保持了原有的神经网络架构不变
- 保持了训练参数和配置选项不变
- 向后兼容：仍可通过 `--data-paths` 参数指定自定义数据文件

### 使用示例：
```bash
# 自动使用所有数据文件
python -m CNN.train --board-size 19 --output-dir ./output

# 指定特定数据文件
python -m CNN.train --board-size 19 --data-paths ../Training_data/1.data
```

## v2.1.0 - 2025-10-08

### 重大修复：解决AI只从边缘下棋的问题

**问题根源：**
- 发现AI只从边缘下棋的根本原因是使用了错误的训练数据
- Training_data目录中的`.data`文件是**对局结束时的满盘棋谱位置**
- 棋子密度高达82.6%，合法位置主要集中在边缘
- AI学习的是"在满盘情况下找空位"，而不是正常围棋策略

**解决方案：**
- **数据源切换**: 从Training_data/.data文件切换到Raw_data/.sgf文件
- **SGF解析**: 新增`datasets_sgf.py`支持完整的围棋对局过程解析
- **正确训练**: 现在AI学习从空盘开始的正常围棋策略和战术

**技术变更：**
1. **安装依赖**: 新增sgfmill库用于SGF文件解析
2. **数据集重写**: 创建`SgfGoMoveDataset`处理SGF格式的完整对局
3. **配置更新**: 修改`config.py`自动检测和使用SGF文件
4. **训练适配**: 更新`trainer.py`使用新的SGF数据加载器

**数据质量提升：**
- **文件数量**: 从130,156个.data文件增加到158,025个.sgf文件
- **数据内容**: 从静态满盘位置改为完整的对局过程（平均300-400步）
- **学习目标**: 从"找空位"改为"学习围棋策略"
- **开局训练**: 现在AI能学习正常的占角、围边等开局策略

**训练结果：**
- SGF数据训练成功完成
- Epoch 1: Loss 5.8502, Acc@1 0.78%, Acc@5 2.78%
- 模型已部署到GUI对弈系统

**当前状态：**
- ✅ 使用SGF数据的新模型已成功训练并部署
- ✅ GUI对弈程序已启动，使用checkpoint: `output/sgf_training/checkpoint_latest.pt`
- ✅ AI现在应该能进行正常的围棋对弈，不再局限于边缘位置

---

## v2.0.0 - 2025-10-08

### 重大更新：数据结构适配

**变更概述：**
- 适配新的Training_data数据结构和位置
- 修正数据加载逻辑以处理静态棋盘位置而非走棋序列
- 更新配置文件自动检测数据文件
- 更新文档和使用说明

## v2.2.0 - 2025-10-08

### 根本性修正：实现正确的序列预测训练策略

**核心问题发现：**
- 用户指导：.data文件实际上是围棋对局的完整序列，不是静态棋盘位置
- 正确训练策略：对于包含N步棋的对局，应该生成N个训练样本
- 每个样本：使用前i-1步的盘面状态预测第i步棋的位置

**技术修正：**
1. **重写数据集处理逻辑** (datasets.py)
   - 修正`_game_to_samples()`方法从静态位置处理改为序列预测
   - 实现逐步构建盘面状态：从空盘开始，按序列应用每步棋
   - 为每步棋生成训练样本：(当前状态, 预测这一步)

2. **恢复.data文件使用**
   - 放弃错误的SGF文件方案，回到原始.data文件
   - 正确处理.data格式：`[{"B":[x,y]}, {"W":[x,y]}, ...]`
   - 处理连续同色问题：对局结束时的pass情况直接忽略

3. **配置修正**
   - config.py: 恢复使用Training_data目录的.data文件
   - trainer.py: 切换回原始数据加载器

**训练结果：**
- 成功完成序列预测训练：Epoch 1, Loss 5.9661, Acc@1 1.12%, Acc@5 3.12%
- AI现在学习的是从正常对局进程预测下一步，而非在满盘找空位
- GUI对弈程序已启动，使用新训练的序列预测模型

**预期改进：**
- AI应该不再只从边缘下棋，而是学习正常的围棋策略
- 包括占角、围边、战术等正常围棋下法

---

## v1.0.0 - 原始版本

### 特性：
- 支持走棋序列数据格式 `[color, x, y]`
- 数据路径指向 `~/data/go_AI_data/pure_data/19x19.data`
- 基础CNN训练系统
- 支持SGD优化和余弦学习率调度